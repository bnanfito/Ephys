

animal = 'febg9';
unit = 'MMM';
U = 6;
dat = uDat(uDat.uID == U,:);


figure; 
lw = 1.5;
subplot(2,2,3); hold on
maxTrial = 0;
for f = 1:height(dat)
    nTrials = max(max(dat.fr{f}.trial));
    yOffset = nTrials*(dat.fileID{f}(1)-1);
    x = dat.raster{f}(1,:);
    y = dat.raster{f}(2,:)+yOffset;
    if dat.fileID{f}(2)==2
        patch([-1 -0.9 -0.9 -1],[maxTrial+1 maxTrial+1 maxTrial+nTrials maxTrial+nTrials],'c','EdgeColor','none')
    end
    plot(x,y,'k.')
    maxTrial = maxTrial+nTrials;
end
patch([0 1 1 0],[0 0 maxTrial+1 maxTrial+1],'k','EdgeColor','none','FaceAlpha',0.1)
xlim([-1 2])
ylim([0 maxTrial+1])


fileID = vertcat(dat.fileID{:});
for c = 1:2
    if c == 1 %warm
        bit = (fileID(:,2) == 1) | (fileID(:,2) == 3);
        clr = 'k';
    elseif c == 2 %cool
        bit = fileID(:,2) == 2;
        clr = 'c';
    end

    subplot(2,2,1)
    gRaster = [dat(bit,:).raster{:}];
    nTrials = 0;
    for f = find(bit')
        nTrials = nTrials + max(max(dat.fr{f}.trial));
    end
    binW = 0.1;
    hist = histogram(gRaster(1,:),[-1:binW:2],'EdgeColor','none','FaceColor',clr,'FaceAlpha',0.5);hold on
    hist.BinCounts = (hist.BinCounts/nTrials)/binW;

    subplot(2,2,2); hold on
    x = mean( vertcat(dat.tuningX{bit}) );
    y = vertcat(dat.tuningY{bit});
    sem = std(y)/sqrt(size(y,1));
    plot(x,mean(y),[clr 'o'],'LineWidth',lw)
    plot(repmat(x,2,1),mean(y)+([-1;1]*sem),clr,'LineWidth',lw)

end

[wvData,wvAvg,wvError]=waveformReader('D:\data\Ephys','D:\data\Ephys',animal,unit,'000006000007000011',1,U,20,0);
subplot(2,2,4);hold on
plot(wvData(:,:)','Color',[0.8 0.8 0.8])
plot(wvAvg,'k','LineWidth',lw)
plot((wvAvg+([-1;1]*wvError))','k--','LineWidth',lw)



